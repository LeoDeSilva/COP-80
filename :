const { Evaluate } = require("./Evaluator/evaluator.js");
const { CreateEnvironment } = require("./Evaluator/objects.js")
const { TOKENS } = require("../Lexer/tokens")

class Interpreter {
  constructor(kernel, env) { // AST
    this.Kernel = kernel;
    this.Environment = env
    //this.AST = AST
    //this.Environment = CreateEnvironment()
    this.error = "";
  }

  Start() {
    this.Kernel.DisplayChip.FillScreen(0);
    if (this.Environment.Global["_UPDATE"] && this.Environment.Global["_UPDATE"].Type == TOKENS.FUNCTION) {
      let [result, resultErr] = Evaluate(this.Environment.Gloal["_UPDATE"], this.Environment)
      if (resultErr != null) {
        this.error = resultErr.msg
        return
      }
    }
    //this.Interpret();
  }

  Update() {
    if (this.Kernel.loadedProgram != this) return;

    if (this.Kernel.KeyboardChip.isPressed("Escape") || this.error != "") {
      if (this.error != "") {
        // assuming lastProgram is terminal, if providing errors, assign permentant terminal to kernel
        this.Kernel.lastProgram.History.push({
          type: "string",
          content: this.error,
          colour: 14,
        });
      }

      this.Kernel.KeyboardChip.clean();
      this.Kernel.Resume(this.Kernel.lastProgram);
    }

  }

  Interpret() {
    //let [result, evalulatorErr] = Evaluate(this.AST, this.Environment)
    //if (evalulatorErr != null) {
      //this.error = evalulatorErr.msg
      //return
    //}
  }
}

module.exports = {
  Interpreter,
};
